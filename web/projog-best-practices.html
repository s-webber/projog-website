<h2>Best Practices</h2>
<p>
Below are examples of "best practices" used in the implementation of the <a href="http://www.projog.org/" title="Prolog logic programming language for the Java platform" target="_blank">Projog</a> project.
(The headings in <b>bold</b> are taken from <i>Effective Java, Second Edition</i> Addison Whiley, 2008.)
</p>

<div class="subsection">
<b>Obey the general contract when overriding equals</b><br>
<b>Always override hashCode when you override equals</b><br>
<b>Consider implementing Comparable</b><br>
<b>Consistently use the Override annotation</b><br>
<b>Minimize mutability</b><br>
<b>In public classes, use accessor methods, not public fields</b><br>
<b>Adhere to generally accepted naming conventions</b><br>
The <a href="http://www.projog.org/javadoc/org/projog/core/predicate/PredicateKey.html" title="org.projog.core.predicate.PredicateKey" target="_blank"><code>PredicateKey</code></a> class is used to represent the structure of a term.
As <code>PredicateKey</code> is used as the key of a <code>java.util.TreeMap</code> it needs to 
correctly override both <code>hashCode()</code> and <code>equals(Object)</code> and implement <code>java.lang.Comparable</code>.
All overriden methods have the <code>@Override</code> annotation.
The only member variables are an <code>int</code> and a <code>String</code> - as both are <code>final</code>, instances of <code>PredicateKey</code> are immutable.
Member variables are only accessible via <code>get</code> methods.
The use of <code>get</code> methods follows the accepted naming convention.
</div>

<div class="subsection">
<b>Minimize the accessibility of classes and members</b><br>
<code>org.projog.core.parser.TokenParser</code> is only designed to be used by other classes
in <code>org.projog.core.parser</code> and so the class and methods have default accessibility.
</div>

<div class="subsection">
<b>Consider static factory methods instead of constructors</b><br>
New instances of <a href="http://www.projog.org/javadoc/org/projog/core/term/Structure.html" title="org.projog.core.term.Structure" target="_blank"><code>Structure</code></a> are created through its static factory method.
The advantage of using a static factory method rather than a public constructor is that the factory method
can return an object that is not an instance of <code>Structure</code> - including an object that already exists.
</div>

<div class="subsection">
<b>Enforce noninstantiability with a private constructor</b><br>
<b>Use interfaces only to define types</b><br>
<a href="http://www.projog.org/javadoc/org/projog/core/term/ListFactory.html" title="org.projog.core.term.ListFactory" target="_blank"><code>ListFactory</code></a> and <a href="http://www.projog.org/javadoc/org/projog/core/term/TermUtils.html" title="org.projog.core.term.TermUtils" target="_blank"><code>TermUtils</code></a> contain static helper methods.
Their private constructors ensure no instances are unnecessarily created.
Both classes also define constants (static final fields) - this is preferable to using an interface to export constants.
</div>

<div class="subsection">
<b>Enforce the singleton property with a private constructor or an enum type</b><br>
<b>Avoid creating unnecessary objects</b><br>
<a href="http://www.projog.org/javadoc/org/projog/core/term/EmptyList.html" title="org.projog.core.term.EmptyList" target="_blank"><code>EmptyList</code></a> represents an immutable term that is commonly used in Prolog rules and queries.
To avoid creating unnecessary objects it is implemented as a singleton and the same instance reused.
A single instance of the class is enforced by making the constructor <code>private</code> and 
providing a <code>public static final</code> variable.
</div>

<div class="subsection">
<b>Make defensive copies when needed</b><br>
The implementation of <code>Iterator.next()</code> provided by the <code>ImplicationsIterator</code>
returned by <a href="http://www.projog.org/javadoc/org/projog/core/predicate/udp/StaticUserDefinedPredicateFactory.html#getImplications--" title="org.projog.core.predicate.udp.StaticUserDefinedPredicateFactory.getImplications()" target="_blank"><code>StaticUserDefinedPredicateFactory.getImplications()</code></a>
returns a <i>copy</i> of the <a href="http://www.projog.org/javadoc/org/projog/core/predicate/udp/ClauseModel.html" title="org.projog.core.predicate.udp.ClauseModel" target="_blank"><code>ClauseModel</code></a> to avoid the original being altered by the caller.
</div>

<div class="subsection">
<b>Use enums instead of int constants</b><br>
<b>Avoid strings where other types are more appropriate</b><br>
<b>Use instance fields instead of ordinals</b><br>
The type of a term can be identified by its <a href="http://www.projog.org/javadoc/org/projog/core/term/TermType.html" title="org.projog.core.term.TermType" target="_blank"><code>TermType</code></a>.
An advantage of using an <code>enum</code>, instead of an <code>int</code> or a <code>String</code>, is that it can have data associated with it.
Each type has a precedence which is used for ordering terms of different types.
Rather than relying on <code>ordinal()</code> there is a <code>getPrecedence()</code> method.
</div>

<div class="subsection">
<b>Prefer interfaces to abstract classes</b><br>
The advantage of <a href="http://www.projog.org/javadoc/org/projog/core/predicate/PredicateFactory.html" title="org.projog.core.predicate.PredicateFactory" target="_blank"><code>PredicateFactory</code></a> and <a href="http://www.projog.org/javadoc/org/projog/core/predicate/Predicate.html" title="org.projog.core.predicate.Predicate" target="_blank"><code>Predicate</code></a>
being interfaces is that a class can implement both of them.
The abstract skeletal classes <code>AbstractRetryablePredicate</code> 
and <code>AbstractSingletonPredicate</code> can be used to avoid having 
to implement the full functionality of the interfaces for each implementation.
</div>

<div class="subsection">
<b>Prefer interfaces to reflection</b><br>
Although <code>CompiledPredicateClassGenerator</code>
uses reflection to construct classes generated at runtime, once created it refers to them using
the <code>CompiledPredicate</code> interface.
</div>

<div class="subsection">
<b>Use function objects to represent strategies</b><br>
Each implementation of <code>Calculatable</code> defines a concrete <a href="projog-design-patterns#strategy" title="Strategy design pattern">strategy</a>.
</div>

<div class="subsection">
<b>Know and use the libraries</b><br>
Projog uses classes from <code>java.util</code> and <code>java.io</code>.
</div>

<div class="subsection">
<b>Beware the performance of string concatenation</b><br>
<a href="http://www.projog.org/javadoc/org/projog/core/predicate/builtin/io/Write.html" title="org.projog.core.predicate.builtin.io.Write" target="_blank"><code>Write</code></a> uses <code>StringBuilder</code> for
constructing the <code>String</code> representation of a term.
</div>

<div class="subsection">
<b>Favor the use of standard exceptions</b><br>
Projog code creates and throws instances of <code>IllegalStateException</code> and <code>UnsupportedOperationException</code>.
</div>

<div class="subsection">
<b>Include failure-capture information in detail messages</b><br>
<a href="http://www.projog.org/javadoc/org/projog/core/parser/ParserException.html" title="org.projog.core.parser.ParserException" target="_blank"><code>ParserException</code></a> contains methods to access failure-capture information (line contents, line number and column number).
</div>

<div class="subsection">
<b>Synchronize access to shared mutable data</b><br>
<a href="http://www.projog.org/javadoc/org/projog/core/kb/KnowledgeBaseServiceLocator.html" title="org.projog.core.kb.KnowledgeBaseServiceLocator" target="_blank"><code>KnowledgeBaseServiceLocator</code></a> contains a <code>synchronized</code> block 
to control access to the internal collection that maintains a record of arithmetic functions.
</div>

<div class="subsection">
<b>Prefer primitive types to boxed primitives</b><br>
<a href="http://www.projog.org/javadoc/org/projog/core/term/IntegerNumber.html" title="org.projog.core.term.IntegerNumber" target="_blank"><code>IntegerNumber</code></a> and <a href="http://www.projog.org/javadoc/org/projog/core/term/DecimalFraction.html" title="org.projog.core.term.DecimalFraction" target="_blank"><code>DecimalFraction</code></a>
both use primitive types to store their internal state.
</div>

<div class="subsection">
<b>Minimize the scope of local variables</b><br>
<b>Prefer for-each loops to traditional for loops</b><br>
<b>Refer to objects by their interfaces</b><br>
<b>Don't use raw types in new code</b><br>
The "best practices" of minimising the scope of local variables, use of the "enhanced" for loop, 
referring to objects by their interfaces and avoiding raw types are followed throughout the Projog code base.
A method that implements all these practices is <a href="http://www.projog.org/javadoc/org/projog/api/QueryStatement.html#getResult--" title="org.projog.api.QueryStatement.getResult()" target="_blank"><code>QueryStatement.getResult()</code></a>.
</div>

<div class="subsection">
<b>Implement Serializable judiciously</b><br>
<b>Override clone judiciously</b><br>
<b>Avoid finalizers</b><br>
<b>Use native methods judiciously</b><br>
<b>Avoid thread groups</b><br>
<b>Don't depend on the thread scheduler</b><br>
Projog classes do not implement <code>java.io.Serializable</code>, <code>java.lang.Cloneable</code>, <code>Object.finalize()</code> or native methods.
Projog classes do not use <code>java.lang.ThreadGroup</code>. 
Projog does not depend on a particular implementation of the thread scheduler.
</div>

<div class="subsection">
<b>Eliminate unchecked warnings</b><br>
The build process compiles using the <code>-Xlint</code> flag to show warnings.
Depending on what is most appropriate, the cause of any compiler warnings are either removed or marked with an annotation.
</div>

<div class="subsection">
<b>Write doc comments for all exposed API elements</b><br>
Projog code contains javadoc comments.
The <a href="http://www.projog.org/javadoc/index.html" target="_blank">Projog javadoc</a> is produced as part of the project's build process.
</div>

<div class="subsection">
<b>Optimize judiciously</b><br>
The first attempt at providing a Prolog inference engine worked in an interpreted mode without any optimisations.
Only once the interpreted version was working did work begin on a version that compiled Prolog syntax to Java bytecode at runtime.
The original interpreted version still exists alongside the compiled versions as a reference.
As part of the build process, the system tests are run against both versions to check for inconsistencies.
</div>